import"./transform.Db-NgJu-.js";import{H as Rn,I as Zn,J as $,K as X,L as Q,N as An,O as U,P as Dn,Q as Kn,R as Ln,S as Vn,T as jn,U as Nn,V as qn,W as Hn,X as Jn,Y as Pn,Z as tn,_ as Qn,$ as Un,a0 as z,a1 as Wn,a2 as W,a3 as _n,a4 as rn,a5 as ne,a6 as ee,a7 as C,a8 as te,E as on,a9 as re,aa as oe,ab as ie,ac as ce}from"./index.DrA8R0kw.js";import{q as _,e as E,t as se,a as fe,b as ue}from"./linear.DZfyr4Dt.js";function R(n,e){let t=0;if(e===void 0)for(let r of n)r!=null&&(r=+r)>=r&&++t;else{let r=-1;for(let o of n)(o=e(o,++r,n))!=null&&(o=+o)>=o&&++t}return t}function ae(n){return Math.max(1,Math.ceil(Math.log(R(n))/Math.LN2)+1)}function le(n,e,t){const r=R(n),o=_(n,.75)-_(n,.25);return r&&o?Math.ceil((t-e)/(2*o*Math.pow(r,-1/3))):1}function cn(n,e,t){const r=R(n),o=Rn(n);return r&&o?Math.ceil((t-e)*Math.cbrt(r)/(3.49*o)):1}function de(n={y:"count"},e={}){[n,e]=ye(n,e);const{x:t,y:r}=e;return he(be(t,e,tn),null,null,r,n,Zn(e))}function me(n,e,t={}){if(t?.interval==null)return t;const{reduce:r=ce}=t,o={filter:null};return t[e]!=null&&(o[e]=r),t[`${e}1`]!=null&&(o[`${e}1`]=r),t[`${e}2`]!=null&&(o[`${e}2`]=r),n(o,t)}function Re(n={}){return me(de,"y",Qn(n,"x"))}function he(n,e,t,r,{data:o=Dn,filter:i=Kn,sort:u,reverse:l,...f}={},a={}){n=nn(n),e=nn(e),f=Ie(f,a),o=un(o,tn),u=u==null?void 0:sn("sort",u,a),i=i==null?void 0:fn("filter",i,a),r!=null&&$(f,"y","y1","y2")&&(r=null);const[s,d]=X(n),[c,m]=X(n),[h,I]=X(e),[B,y]=X(e),[A,D]=r!=null?[r,"y"]:[],[K,ln]=X(A),{x:dn,y:mn,z:O,fill:L,stroke:V,x1:hn,x2:yn,y1:bn,y2:xn,domain:Ce,cumulative:Ee,thresholds:Oe,interval:ke,...In}=a,[pn,Bn]=X(O),[j]=Q(L),[N]=Q(V),[Xn,gn]=X(j),[Gn,Fn]=X(N);return{..."z"in a&&{z:pn||O},..."fill"in a&&{fill:Xn||L},..."stroke"in a&&{stroke:Gn||V},...An(In,(b,k,Mn)=>{const v=Un(z(b,A),Mn?.[D]),F=z(b,O),M=z(b,j),Y=z(b,N),w=Wn(f,{z:F,fill:M,stroke:Y}),T=[],q=[],Yn=v&&ln([]),wn=F&&Bn([]),zn=M&&gn([]),Sn=Y&&Fn([]),H=n&&d([]),Cn=n&&m([]),J=e&&I([]),En=e&&y([]),On=Xe(n,e,b);let kn=0;for(const g of f)g.initialize(b);u&&u.initialize(b),i&&i.initialize(b);for(const g of k){const P=[];for(const G of f)G.scope("facet",g);u&&u.scope("facet",g),i&&i.scope("facet",g);for(const[G,vn]of W(g,w))for(const[Tn,S]of W(vn,v))for(const[x,p]of On(S))if(w&&(p.z=G),!(i&&!i.reduce(x,p))){P.push(kn++),q.push(o.reduceIndex(x,b,p)),v&&Yn.push(Tn),F&&wn.push(w===F?G:F[(x.length>0?x:S)[0]]),M&&zn.push(w===M?G:M[(x.length>0?x:S)[0]]),Y&&Sn.push(w===Y?G:Y[(x.length>0?x:S)[0]]),H&&(H.push(p.x1),Cn.push(p.x2)),J&&(J.push(p.y1),En.push(p.y2));for(const $n of f)$n.reduce(x,p);u&&u.reduce(x,p)}T.push(P)}return _n(T,u,l),{data:q,facets:T}}),...!$(f,"x")&&(s?{x1:s,x2:c,x:U(s,c)}:{x:dn,x1:hn,x2:yn}),...!$(f,"y")&&(h?{y1:h,y2:B,y:U(h,B)}:{y:mn,y1:bn,y2:xn}),...K&&{[D]:K},...Object.fromEntries(f.map(({name:b,output:k})=>[b,k]))}}function ye({cumulative:n,domain:e,thresholds:t,interval:r,...o},i){return[o,{cumulative:n,domain:e,thresholds:t,interval:r,...i}]}function be(n,{cumulative:e,domain:t,thresholds:r,interval:o},i){return n={...Ln(n)},n.domain===void 0&&(n.domain=t),n.cumulative===void 0&&(n.cumulative=e),n.thresholds===void 0&&(n.thresholds=r),n.interval===void 0&&(n.interval=o),n.value===void 0&&(n.value=i),n.thresholds=xe(n.thresholds,n.interval),n}function nn(n){if(n==null)return;const{value:e,cumulative:t,domain:r=E,thresholds:o}=n,i=u=>{let l=z(u,e),f;if(rn(l)||Be(o)){l=ne(l,ee,Float64Array);let[s,d]=typeof r=="function"?r(l):r,c=typeof o=="function"&&!C(o)?o(l,s,d):o;typeof c=="number"&&(c=te(s,d,c)),C(c)&&(r===E&&(s=c.floor(s),d=c.offset(c.floor(d))),c=c.range(s,c.offset(d))),f=c}else{l=on(l);let[s,d]=typeof r=="function"?r(l):r,c=typeof o=="function"&&!C(o)?o(l,s,d):o;if(typeof c=="number")if(r===E){let m=se(s,d,c);if(isFinite(m))if(m>0){let h=Math.round(s/m),I=Math.round(d/m);h*m<=s||--h,I*m>d||++I;let B=I-h+1;c=new Float64Array(B);for(let y=0;y<B;++y)c[y]=(h+y)*m}else if(m<0){m=-m;let h=Math.round(s*m),I=Math.round(d*m);h/m<=s||--h,I/m>d||++I;let B=I-h+1;c=new Float64Array(B);for(let y=0;y<B;++y)c[y]=(h+y)/m}else c=[s];else c=[s]}else c=fe(s,d,c);else C(c)&&(r===E&&(s=c.floor(s),d=c.offset(c.floor(d))),c=c.range(s,c.offset(d)));f=c}const a=[];if(f.length===1)a.push([f[0],f[0]]);else for(let s=1;s<f.length;++s)a.push([f[s-1],f[s]]);return a.bin=(t<0?Ge:t>0?ge:Z)(a,f,l),a};return i.label=Vn(e),i}function xe(n,e,t=en){if(n===void 0)return e===void 0?t:jn(e);if(typeof n=="string"){switch(n.toLowerCase()){case"freedman-diaconis":return le;case"scott":return cn;case"sturges":return ae;case"auto":return en}return Nn(n)}return n}function Ie(n,e){return qn(n,e,sn)}function sn(n,e,t){return Hn(n,e,t,fn)}function fn(n,e,t){return Jn(n,e,t,un)}function un(n,e){return Pn(n,e,pe)}function pe(n){switch(`${n}`.toLowerCase()){case"x":return Fe;case"x1":return Ye;case"x2":return we;case"y":return Me;case"y1":return ze;case"y2":return Se;case"z":return re}throw new Error(`invalid bin reduce: ${n}`)}function en(n,e,t){return Math.min(200,cn(n,e,t))}function Be(n){return oe(n)||ie(n)&&rn(n)}function Xe(n,e,t){const r=n?.(t),o=e?.(t);return r&&o?function*(i){const u=r.bin(i);for(const[l,[f,a]]of r.entries()){const s=o.bin(u[l]);for(const[d,[c,m]]of o.entries())yield[s[d],{data:t,x1:f,y1:c,x2:a,y2:m}]}}:r?function*(i){const u=r.bin(i);for(const[l,[f,a]]of r.entries())yield[u[l],{data:t,x1:f,x2:a}]}:function*(i){const u=o.bin(i);for(const[l,[f,a]]of o.entries())yield[u[l],{data:t,y1:f,y2:a}]}}function Z(n,e,t){return e=on(e),r=>{const o=n.map(()=>[]);for(const i of r)o[ue(e,t[i])-1]?.push(i);return o}}function ge(n,e,t){const r=Z(n,e,t);return o=>{const i=r(o);for(let u=1,l=i.length;u<l;++u){const f=i[u-1],a=i[u];for(const s of f)a.push(s)}return i}}function Ge(n,e,t){const r=Z(n,e,t);return o=>{const i=r(o);for(let u=i.length-2;u>=0;--u){const l=i[u+1],f=i[u];for(const a of l)f.push(a)}return i}}function an(n,e){const t=(+n+ +e)/2;return n instanceof Date?new Date(t):t}const Fe={reduceIndex(n,e,{x1:t,x2:r}){return an(t,r)}},Me={reduceIndex(n,e,{y1:t,y2:r}){return an(t,r)}},Ye={reduceIndex(n,e,{x1:t}){return t}},we={reduceIndex(n,e,{x2:t}){return t}},ze={reduceIndex(n,e,{y1:t}){return t}},Se={reduceIndex(n,e,{y2:t}){return t}};export{de as b,R as c,Re as m,ae as t};
