import"./transform.BNP73y-7.js";import{_ as P,Z as Zn,$ as An,a0 as T,a1 as B,a2 as Q,a3 as Dn,a4 as U,a5 as Rn,a6 as jn,a7 as Kn,a8 as Ln,a9 as Vn,aa as qn,ab as Nn,ac as _n,ad as Hn,ae as Jn,r as tn,af as Pn,ag as Qn,ah as v,ai as Un,aj as W,ak as Wn,al as rn,am as ne,an as ee,ao as k,ap as te,aq as C,X as on,t as re,ar as oe,as as ce,at as ie,au as se,av as ae,aw as ue}from"./index.JoTaYIke.js";function Z(n,e){let t=0;for(let r of n)r!=null&&(r=+r)>=r&&++t;return t}function fe(n){return Math.max(1,Math.ceil(Math.log(Z(n))/Math.LN2)+1)}function le(n,e,t){const r=Z(n),o=P(n,.75)-P(n,.25);return r&&o?Math.ceil((t-e)/(2*o*Math.pow(r,-1/3))):1}function cn(n,e,t){const r=Z(n),o=Zn(n);return r&&o?Math.ceil((t-e)*Math.cbrt(r)/(3.49*o)):1}function de(n={y:"count"},e={}){[n,e]=ye(n,e);const{x:t,y:r}=e;return me(be(t,e,tn),null,null,r,n,An(e))}function he(n,e,t={}){if(t?.interval==null)return t;const{reduce:r=ue}=t,o={filter:null};return t[e]!=null&&(o[e]=r),t[`${e}1`]!=null&&(o[`${e}1`]=r),t[`${e}2`]!=null&&(o[`${e}2`]=r),n(o,t)}function Te(n={}){return he(de,"y",Pn(n,"x"))}function me(n,e,t,r,{data:o=Rn,filter:c=jn,sort:u,reverse:l,...a}={},f={}){n=nn(n),e=nn(e),a=Ie(a,f),o=un(o,tn),u=u==null?void 0:sn("sort",u,f),c=c==null?void 0:an("filter",c,f),r!=null&&T(a,"y","y1","y2")&&(r=null);const[s,d]=B(n),[i,h]=B(n),[m,I]=B(e),[g,y]=B(e),[D,R]=r!=null?[r,"y"]:[],[j,ln]=B(D),{x:dn,y:hn,z:S,fill:K,stroke:L,x1:mn,x2:yn,y1:bn,y2:xn,domain:ke,cumulative:Ce,thresholds:Se,interval:Ee,...In}=f,[pn,gn]=B(S),[V]=Q(K),[q]=Q(L),[Bn,Xn]=B(V),[Gn,Fn]=B(q);return{..."z"in f&&{z:pn||S},..."fill"in f&&{fill:Bn||K},..."stroke"in f&&{stroke:Gn||L},...Dn(In,(b,E,Mn)=>{const O=Qn(v(b,D),Mn?.[R]),F=v(b,S),M=v(b,V),w=v(b,q),Y=Un(a,{z:F,fill:M,stroke:w}),$=[],N=[],wn=O&&ln([]),Yn=F&&gn([]),vn=M&&Xn([]),zn=w&&Fn([]),_=n&&d([]),kn=n&&h([]),H=e&&I([]),Cn=e&&y([]),Sn=Be(n,e,b);let En=0;for(const X of a)X.initialize(b);u&&u.initialize(b),c&&c.initialize(b);for(const X of E){const J=[];for(const G of a)G.scope("facet",X);u&&u.scope("facet",X),c&&c.scope("facet",X);for(const[G,On]of W(X,Y))for(const[$n,z]of W(On,O))for(const[x,p]of Sn(z))if(Y&&(p.z=G),!(c&&!c.reduce(x,p))){J.push(En++),N.push(o.reduceIndex(x,b,p)),O&&wn.push($n),F&&Yn.push(Y===F?G:F[(x.length>0?x:z)[0]]),M&&vn.push(Y===M?G:M[(x.length>0?x:z)[0]]),w&&zn.push(Y===w?G:w[(x.length>0?x:z)[0]]),_&&(_.push(p.x1),kn.push(p.x2)),H&&(H.push(p.y1),Cn.push(p.y2));for(const Tn of a)Tn.reduce(x,p);u&&u.reduce(x,p)}$.push(J)}return Wn($,u,l),{data:N,facets:$}}),...!T(a,"x")&&(s?{x1:s,x2:i,x:U(s,i)}:{x:dn,x1:mn,x2:yn}),...!T(a,"y")&&(m?{y1:m,y2:g,y:U(m,g)}:{y:hn,y1:bn,y2:xn}),...j&&{[R]:j},...Object.fromEntries(a.map(({name:b,output:E})=>[b,E]))}}function ye({cumulative:n,domain:e,thresholds:t,interval:r,...o},c){return[o,{cumulative:n,domain:e,thresholds:t,interval:r,...c}]}function be(n,{cumulative:e,domain:t,thresholds:r,interval:o},c){return n={...Kn(n)},n.domain===void 0&&(n.domain=t),n.cumulative===void 0&&(n.cumulative=e),n.thresholds===void 0&&(n.thresholds=r),n.interval===void 0&&(n.interval=o),n.value===void 0&&(n.value=c),n.thresholds=xe(n.thresholds,n.interval),n}function nn(n){if(n==null)return;const{value:e,cumulative:t,domain:r=C,thresholds:o}=n,c=u=>{let l=v(u,e),a;if(rn(l)||ge(o)){l=ne(l,ee,Float64Array);let[s,d]=typeof r=="function"?r(l):r,i=typeof o=="function"&&!k(o)?o(l,s,d):o;typeof i=="number"&&(i=te(s,d,i)),k(i)&&(r===C&&(s=i.floor(s),d=i.offset(i.floor(d))),i=i.range(s,i.offset(d))),a=i}else{l=on(l);let[s,d]=typeof r=="function"?r(l):r,i=typeof o=="function"&&!k(o)?o(l,s,d):o;if(typeof i=="number")if(r===C){let h=re(s,d,i);if(isFinite(h))if(h>0){let m=Math.round(s/h),I=Math.round(d/h);m*h<=s||--m,I*h>d||++I;let g=I-m+1;i=new Float64Array(g);for(let y=0;y<g;++y)i[y]=(m+y)*h}else if(h<0){h=-h;let m=Math.round(s*h),I=Math.round(d*h);m/h<=s||--m,I/h>d||++I;let g=I-m+1;i=new Float64Array(g);for(let y=0;y<g;++y)i[y]=(m+y)/h}else i=[s];else i=[s]}else i=oe(s,d,i);else k(i)&&(r===C&&(s=i.floor(s),d=i.offset(i.floor(d))),i=i.range(s,i.offset(d)));a=i}const f=[];if(a.length===1)f.push([a[0],a[0]]);else for(let s=1;s<a.length;++s)f.push([a[s-1],a[s]]);return f.bin=(t<0?Ge:t>0?Xe:A)(f,a,l),f};return c.label=Ln(e),c}function xe(n,e,t=en){if(n===void 0)return e===void 0?t:Vn(e);if(typeof n=="string"){switch(n.toLowerCase()){case"freedman-diaconis":return le;case"scott":return cn;case"sturges":return fe;case"auto":return en}return qn(n)}return n}function Ie(n,e){return Nn(n,e,sn)}function sn(n,e,t){return _n(n,e,t,an)}function an(n,e,t){return Hn(n,e,t,un)}function un(n,e){return Jn(n,e,pe)}function pe(n){switch(`${n}`.toLowerCase()){case"x":return Fe;case"x1":return we;case"x2":return Ye;case"y":return Me;case"y1":return ve;case"y2":return ze;case"z":return ce}throw new Error(`invalid bin reduce: ${n}`)}function en(n,e,t){return Math.min(200,cn(n,e,t))}function ge(n){return ie(n)||se(n)&&rn(n)}function Be(n,e,t){const r=n?.(t),o=e?.(t);return r&&o?function*(c){const u=r.bin(c);for(const[l,[a,f]]of r.entries()){const s=o.bin(u[l]);for(const[d,[i,h]]of o.entries())yield[s[d],{data:t,x1:a,y1:i,x2:f,y2:h}]}}:r?function*(c){const u=r.bin(c);for(const[l,[a,f]]of r.entries())yield[u[l],{data:t,x1:a,x2:f}]}:function*(c){const u=o.bin(c);for(const[l,[a,f]]of o.entries())yield[u[l],{data:t,y1:a,y2:f}]}}function A(n,e,t){return e=on(e),r=>{const o=n.map(()=>[]);for(const c of r)o[ae(e,t[c])-1]?.push(c);return o}}function Xe(n,e,t){const r=A(n,e,t);return o=>{const c=r(o);for(let u=1,l=c.length;u<l;++u){const a=c[u-1],f=c[u];for(const s of a)f.push(s)}return c}}function Ge(n,e,t){const r=A(n,e,t);return o=>{const c=r(o);for(let u=c.length-2;u>=0;--u){const l=c[u+1],a=c[u];for(const f of l)a.push(f)}return c}}function fn(n,e){const t=(+n+ +e)/2;return n instanceof Date?new Date(t):t}const Fe={reduceIndex(n,e,{x1:t,x2:r}){return fn(t,r)}},Me={reduceIndex(n,e,{y1:t,y2:r}){return fn(t,r)}},we={reduceIndex(n,e,{x1:t}){return t}},Ye={reduceIndex(n,e,{x2:t}){return t}},ve={reduceIndex(n,e,{y1:t}){return t}},ze={reduceIndex(n,e,{y2:t}){return t}};export{de as b,Te as m,fe as t};
