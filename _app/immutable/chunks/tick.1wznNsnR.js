import"./transform.Cz5Y6iUM.js";import{F as C,G as Y,H as Z,M as L,I as q,J as z,K as Q,l as R,n as D,d as I,o as F,L as U,N as k,q as O,O as V,P as W,Q as $,R as E,S as G,T as H,U as J,V as K,W as j,X as tt,Y as S,Z as et,_ as rt,$ as nt,a as M,a0 as v,a1 as N,a2 as at,a3 as st}from"./index.Bed_awgu.js";import{c as ot}from"./area.CUloC0gn.js";function P(n,e=C){if(typeof n[Symbol.iterator]!="function")throw new TypeError("values is not iterable");let t=Array.from(n);const r=new Float64Array(t.length);e.length!==2&&(t=t.map(e),e=C);const a=(c,i)=>e(t[c],t[i]);let s,o;return n=Uint32Array.from(t,(c,i)=>i),n.sort(e===C?(c,i)=>Y(t[c],t[i]):Z(a)),n.forEach((c,i)=>{const u=a(c,s===void 0?c:s);u>=0?((s===void 0||u>0)&&(s=c,o=i),r[c]=o):r[c]=NaN}),r}const lt={ariaLabel:"dot",fill:"none",stroke:"currentColor",strokeWidth:1.5};function ct(n){return n.sort===void 0&&n.reverse===void 0?W({channel:"-r"},n):n}class it extends L{constructor(e,t={}){const{x:r,y:a,r:s,rotate:o,symbol:c=$,frameAnchor:i}=t,[u,f]=E(o,0),[h,y]=q(c),[p,g]=E(s,h==null?3:4.5);super(e,{x:{value:r,scale:"x",optional:!0},y:{value:a,scale:"y",optional:!0},r:{value:p,scale:"r",filter:z,optional:!0},rotate:{value:u,optional:!0},symbol:{value:h,scale:"auto",optional:!0}},ct(t),lt),this.r=g,this.rotate=f,this.symbol=y,this.frameAnchor=Q(i);const{channels:b}=this,{symbol:d}=b;if(d){const{fill:x,stroke:w}=b;d.hint={fill:x?x.value===d.value?"color":"currentColor":this.fill??"currentColor",stroke:w?w.value===d.value?"color":"currentColor":this.stroke??"none"}}}render(e,t,r,a,s){const{x:o,y:c}=t,{x:i,y:u,r:f,rotate:h,symbol:y}=r,{r:p,rotate:g,symbol:b}=this,[d,x]=G(this,a),w=b===$,T=f?void 0:p*p*Math.PI;return H(p)&&(e=[]),R("svg:g",s).call(D,this,a,s).call(I,this,{x:i&&o,y:u&&c}).call(B=>B.selectAll().data(e).enter().append(w?"circle":"path").call(F,this).call(w?_=>{_.attr("cx",i?l=>i[l]:d).attr("cy",u?l=>u[l]:x).attr("r",f?l=>f[l]:p)}:_=>{_.attr("transform",U`translate(${i?l=>i[l]:d},${u?l=>u[l]:x})${h?l=>` rotate(${h[l]})`:g?` rotate(${g})`:""}`).attr("d",f&&y?l=>{const m=k();return y[l].draw(m,f[l]*f[l]*Math.PI),m}:f?l=>{const m=k();return b.draw(m,f[l]*f[l]*Math.PI),m}:y?l=>{const m=k();return y[l].draw(m,T),m}:(()=>{const l=k();return b.draw(l,T),l})())}).call(O,this,r)).node()}}function kt(n,{x:e,y:t,...r}={}){return r.frameAnchor===void 0&&([e,t]=V(e,t)),new it(n,{...r,x:e,y:t})}function vt(n,e={}){let{y:t,y1:r,y2:a}=e;t===void 0&&r===void 0&&a===void 0&&(e={...e,y:t=M});const s={};return t!=null&&(s.y=n),r!=null&&(s.y1=n),a!=null&&(s.y2=n),ut(s,e)}function ut(n={},e={}){const t=J(e),r=Object.entries(n).map(([a,s])=>{const o=K(a,e);if(o==null)throw new Error(`missing channel: ${a}`);const[c,i]=j(o);return{key:a,input:o,output:c,setOutput:i,map:ft(s)}});return{...tt(e,(a,s)=>{const o=S(a,t),c=r.map(({input:u})=>S(a,u)),i=r.map(({setOutput:u})=>u(new Array(a.length)));for(const u of s)for(const f of o?et(u,h=>o[h]).values():[u])r.forEach(({map:h},y)=>h.mapIndex(f,c[y],i[y]));return{data:a,facets:s}}),...Object.fromEntries(r.map(({key:a,output:s})=>[a,s]))}}function ft(n){if(n==null)throw new Error("missing map");if(typeof n.mapIndex=="function")return n;if(typeof n.map=="function"&&rt(n))return ht(n);if(typeof n=="function")return A(nt(n));switch(`${n}`.toLowerCase()){case"cumsum":return mt;case"rank":return A((e,t)=>P(e,r=>t[r]));case"quantile":return A((e,t)=>yt(e,r=>t[r]))}throw new Error(`invalid map: ${n}`)}function ht(n){return console.warn("deprecated map interface; implement mapIndex instead."),{mapIndex:n.map.bind(n)}}function yt(n,e){const t=ot(n,e)-1;return P(n,e).map(r=>r/t)}function A(n){return{mapIndex(e,t,r){const a=n(e,t);if(a.length!==e.length)throw new Error("map function returned a mismatched length");for(let s=0,o=e.length;s<o;++s)r[e[s]]=a[s]}}}const mt={mapIndex(n,e,t){let r=0;for(const a of n)t[a]=r+=e[a]}},dt={ariaLabel:"tick",fill:null,stroke:"currentColor"};class X extends L{constructor(e,t,r){super(e,t,r,dt),at(this,r)}render(e,t,r,a,s){return R("svg:g",s).call(D,this,a,s).call(this._transform,this,t).call(o=>o.selectAll().data(e).enter().append("line").call(F,this).attr("x1",this._x1(t,r,a)).attr("x2",this._x2(t,r,a)).attr("y1",this._y1(t,r,a)).attr("y2",this._y2(t,r,a)).call(O,this,r).call(st,this,r,s)).node()}}class pt extends X{constructor(e,t={}){const{x:r,y:a,inset:s=0,insetTop:o=s,insetBottom:c=s}=t;super(e,{x:{value:r,scale:"x"},y:{value:a,scale:"y",type:"band",optional:!0}},t),this.insetTop=v(o),this.insetBottom=v(c)}_transform(e,t,{x:r}){e.call(I,t,{x:r},N,0)}_x1(e,{x:t}){return r=>t[r]}_x2(e,{x:t}){return r=>t[r]}_y1({y:e},{y:t},{marginTop:r}){const{insetTop:a}=this;return t&&e?s=>t[s]+a:r+a}_y2({y:e},{y:t},{height:r,marginBottom:a}){const{insetBottom:s}=this;return t&&e?o=>t[o]+e.bandwidth()-s:r-a-s}}class bt extends X{constructor(e,t={}){const{x:r,y:a,inset:s=0,insetRight:o=s,insetLeft:c=s}=t;super(e,{y:{value:a,scale:"y"},x:{value:r,scale:"x",type:"band",optional:!0}},t),this.insetRight=v(o),this.insetLeft=v(c)}_transform(e,t,{y:r}){e.call(I,t,{y:r},0,N)}_x1({x:e},{x:t},{marginLeft:r}){const{insetLeft:a}=this;return t&&e?s=>t[s]+a:r+a}_x2({x:e},{x:t},{width:r,marginRight:a}){const{insetRight:s}=this;return t&&e?o=>t[o]+e.bandwidth()-s:r-a-s}_y1(e,{y:t}){return r=>t[r]}_y2(e,{y:t}){return r=>t[r]}}function _t(n,{x:e=M,...t}={}){return new pt(n,{...t,x:e})}function Ct(n,{y:e=M,...t}={}){return new bt(n,{...t,y:e})}export{vt as a,_t as b,kt as d,ut as m,Ct as t};
