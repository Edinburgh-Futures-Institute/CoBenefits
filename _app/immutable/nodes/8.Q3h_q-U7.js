import{s as de,d as he,n as qt,r as fe,o as pe,e as lt}from"../chunks/scheduler.tir__IPy.js";import{S as me,i as ve,e as v,b as Y,s as I,c as b,d as V,f as Q,g as D,h as T,m as N,n as _,j as ot,k as u,p as be,q as ft,o as ye}from"../chunks/index.bU9Y8Vjw.js";import{e as Xt}from"../chunks/each.-gASlQSi.js";import"../chunks/transform.Bxaw71Wc.js";import{F as At,G as _e,H as ge,b as Mt,I as Jt,M as Kt,J as Wt,K as ke,L as xe,N as Ce,c as $t,a as te,d as ee,O as De,p as pt,e as ne,P as Ae,Q as Rt,R as we,S as Ee,T as Le,U as Ie,V as Te,W as Se,X as Ot,Y as Me,Z as ze,_ as Be,$ as re,a0 as jt,a1 as He,m as Ve,f as Fe,a2 as Ne,q as Pe,a3 as qe,a4 as Xe,x as ae,j as et,a5 as We,i as O,a6 as wt,r as Re,w as Oe,k as Et}from"../chunks/index.8pWjiIHb.js";import{M as je}from"../chunks/map.Dzd9nxDE.js";import{S as St,a as Ut}from"../chunks/globals.xEjTdJsR.js";import{A as Ue,f as Ze,b as le,e as Zt,a as Lt,d as It}from"../chunks/bar.G6Q7ii2p.js";function oe(t,e=At){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");let n=Array.from(t);const r=new Float64Array(n.length);e.length!==2&&(n=n.map(e),e=At);const l=(d,f)=>e(n[d],n[f]);let a,i;return t=Uint32Array.from(n,(d,f)=>f),t.sort(e===At?(d,f)=>_e(n[d],n[f]):ge(l)),t.forEach((d,f)=>{const s=l(d,a===void 0?d:a);s>=0?((a===void 0||s>0)&&(a=d,i=f),r[d]=i):r[d]=NaN}),r}const Ge={ariaLabel:"cell"};class Ye extends Ue{constructor(e,{x:n,y:r,...l}={}){super(e,{x:{value:n,scale:"x",type:"band",optional:!0},y:{value:r,scale:"y",type:"band",optional:!0}},l,Ge)}_transform(e,n){e.call(Mt,n,{},0,0)}}function Gt(t,{x:e,y:n,...r}={}){return[e,n]=Jt(e,n),new Ye(t,{...r,x:e,y:n})}const Qe={ariaLabel:"dot",fill:"none",stroke:"currentColor",strokeWidth:1.5};function Je(t){return t.sort===void 0&&t.reverse===void 0?Ae({channel:"-r"},t):t}class Ke extends Kt{constructor(e,n={}){const{x:r,y:l,r:a,rotate:i,symbol:d=Rt,frameAnchor:f}=n,[s,c]=Wt(i,0),[o,p]=ke(d),[A,x]=Wt(a,o==null?3:4.5);super(e,{x:{value:r,scale:"x",optional:!0},y:{value:l,scale:"y",optional:!0},r:{value:A,scale:"r",filter:xe,optional:!0},rotate:{value:s,optional:!0},symbol:{value:o,scale:"auto",optional:!0}},Je(n),Qe),this.r=x,this.rotate=c,this.symbol=p,this.frameAnchor=Ce(f);const{channels:g}=this,{symbol:y}=g;if(y){const{fill:w,stroke:z}=g;y.hint={fill:w?w.value===y.value?"color":"currentColor":this.fill??"currentColor",stroke:z?z.value===y.value?"color":"currentColor":this.stroke??"none"}}}render(e,n,r,l,a){const{x:i,y:d}=n,{x:f,y:s,r:c,rotate:o,symbol:p}=r,{r:A,rotate:x,symbol:g}=this,[y,w]=we(this,l),z=g===Rt,J=c?void 0:A*A*Math.PI;return Ee(A)&&(e=[]),$t("svg:g",a).call(te,this,l,a).call(Mt,this,{x:f&&i,y:s&&d}).call(K=>K.selectAll().data(e).enter().append(z?"circle":"path").call(ee,this).call(z?q=>{q.attr("cx",f?m=>f[m]:y).attr("cy",s?m=>s[m]:w).attr("r",c?m=>c[m]:A)}:q=>{q.attr("transform",De`translate(${f?m=>f[m]:y},${s?m=>s[m]:w})${o?m=>` rotate(${o[m]})`:x?` rotate(${x})`:""}`).attr("d",c&&p?m=>{const B=pt();return p[m].draw(B,c[m]*c[m]*Math.PI),B}:c?m=>{const B=pt();return g.draw(B,c[m]*c[m]*Math.PI),B}:p?m=>{const B=pt();return p[m].draw(B,J),B}:(()=>{const m=pt();return g.draw(m,J),m})())}).call(ne,this,r)).node()}}function $e(t,{x:e,y:n,...r}={}){return r.frameAnchor===void 0&&([e,n]=Jt(e,n)),new Ke(t,{...r,x:e,y:n})}function tn(t={},e={}){const n=Le(e),r=Object.entries(t).map(([l,a])=>{const i=Ie(l,e);if(i==null)throw new Error(`missing channel: ${l}`);const[d,f]=Te(i);return{key:l,input:i,output:d,setOutput:f,map:en(a)}});return{...Se(e,(l,a)=>{const i=Ot(l,n),d=r.map(({input:s})=>Ot(l,s)),f=r.map(({setOutput:s})=>s(new Array(l.length)));for(const s of a)for(const c of i?Me(s,o=>i[o]).values():[s])r.forEach(({map:o},p)=>o.mapIndex(c,d[p],f[p]));return{data:l,facets:a}}),...Object.fromEntries(r.map(({key:l,output:a})=>[l,a]))}}function en(t){if(t==null)throw new Error("missing map");if(typeof t.mapIndex=="function")return t;if(typeof t.map=="function"&&ze(t))return nn(t);if(typeof t=="function")return Tt(Be(t));switch(`${t}`.toLowerCase()){case"cumsum":return an;case"rank":return Tt((e,n)=>oe(e,r=>n[r]));case"quantile":return Tt((e,n)=>rn(e,r=>n[r]))}throw new Error(`invalid map: ${t}`)}function nn(t){return console.warn("deprecated map interface; implement mapIndex instead."),{mapIndex:t.map.bind(t)}}function rn(t,e){const n=Ze(t,e)-1;return oe(t,e).map(r=>r/n)}function Tt(t){return{mapIndex(e,n,r){const l=t(e,n);if(l.length!==e.length)throw new Error("map function returned a mismatched length");for(let a=0,i=e.length;a<i;++a)r[e[a]]=l[a]}}}const an={mapIndex(t,e,n){let r=0;for(const l of t)n[l]=r+=e[l]}},ln={ariaLabel:"tick",fill:null,stroke:"currentColor"};class on extends Kt{constructor(e,n,r){super(e,n,r,ln),Ve(this,r)}render(e,n,r,l,a){return $t("svg:g",a).call(te,this,l,a).call(this._transform,this,n).call(i=>i.selectAll().data(e).enter().append("line").call(ee,this).attr("x1",this._x1(n,r,l)).attr("x2",this._x2(n,r,l)).attr("y1",this._y1(n,r,l)).attr("y2",this._y2(n,r,l)).call(ne,this,r).call(Fe,this,r,a)).node()}}class sn extends on{constructor(e,n={}){const{x:r,y:l,inset:a=0,insetTop:i=a,insetBottom:d=a}=n;super(e,{x:{value:r,scale:"x"},y:{value:l,scale:"y",type:"band",optional:!0}},n),this.insetTop=jt(i),this.insetBottom=jt(d)}_transform(e,n,{x:r}){e.call(Mt,n,{x:r},He,0)}_x1(e,{x:n}){return r=>n[r]}_x2(e,{x:n}){return r=>n[r]}_y1({y:e},{y:n},{marginTop:r}){const{insetTop:l}=this;return n&&e?a=>n[a]+l:r+l}_y2({y:e},{y:n},{height:r,marginBottom:l}){const{insetBottom:a}=this;return n&&e?i=>n[i]+e.bandwidth()-a:r-l-a}}function G(t,{x:e=re,...n}={}){return new sn(t,{...n,x:e})}function cn(t,{x:e=re,y:n=null,r,fill:l="#ccc",fillOpacity:a,stroke:i="currentColor",strokeOpacity:d,strokeWidth:f=2,sort:s,...c}={}){const o=n!=null?et:We;return Ne(Pe(t,o({x1:se,x2:ie},{x:e,y:n,stroke:i,strokeOpacity:d,...c})),le(t,o({x1:"p25",x2:"p75"},{x:e,y:n,fill:l,fillOpacity:a,...c})),G(t,o({x:"p50"},{x:e,y:n,stroke:i,strokeOpacity:d,strokeWidth:f,sort:s,...c})),$e(t,tn({x:un},{x:e,y:n,z:n,r,stroke:i,strokeOpacity:d,...c})))}function un(t){const e=se(t),n=ie(t);return t.map(r=>r<e||r>n?r:NaN)}function se(t){const e=ce(t)*2.5-ue(t)*1.5;return qe(t,n=>n>=e?n:NaN)}function ie(t){const e=ue(t)*2.5-ce(t)*1.5;return Xe(t,n=>n<=e?n:NaN)}function ce(t){return ae(t,.25)}function ue(t){return ae(t,.75)}function Yt(t,e,n){const r=t.slice();return r[26]=e[n],r[27]=e,r[28]=n,r}function dn(t){let e,n,r,l="",a=t[26],i,d,f,s,c="";const o=()=>t[16](r,a),p=()=>t[16](null,a),A=()=>t[17](s,a),x=()=>t[17](null,a);return{c(){e=v("div"),n=Y(`LAD Distribution:
                            `),r=v("div"),r.innerHTML=l,i=I(),d=v("div"),f=Y(`Global Distribution:
                            `),s=v("div"),s.innerHTML=c,this.h()},l(g){e=b(g,"DIV",{});var y=V(e);n=Q(y,`LAD Distribution:
                            `),r=b(y,"DIV",{class:!0,"data-svelte-h":!0}),N(r)!=="svelte-mmlaxa"&&(r.innerHTML=l),y.forEach(D),i=T(g),d=b(g,"DIV",{});var w=V(d);f=Q(w,`Global Distribution:
                            `),s=b(w,"DIV",{class:!0,"data-svelte-h":!0}),N(s)!=="svelte-k15r1r"&&(s.innerHTML=c),w.forEach(D),this.h()},h(){_(r,"class","plot"),_(s,"class","plot")},m(g,y){ot(g,e,y),u(e,n),u(e,r),o(),ot(g,i,y),ot(g,d,y),u(d,f),u(d,s),A()},p(g,y){t=g,a!==t[26]&&(p(),a=t[26],o()),a!==t[26]&&(x(),a=t[26],A())},d(g){g&&(D(e),D(i),D(d)),p(),x()}}}function hn(t){let e,n="",r=t[26];const l=()=>t[15](e,r),a=()=>t[15](null,r);return{c(){e=v("div"),e.innerHTML=n,this.h()},l(i){e=b(i,"DIV",{class:!0,"data-svelte-h":!0}),N(e)!=="svelte-nw1ojy"&&(e.innerHTML=n),this.h()},h(){_(e,"class","plot")},m(i,d){ot(i,e,d),l()},p(i,d){t=i,r!==t[26]&&(a(),r=t[26],l())},d(i){i&&D(e),a()}}}function Qt(t){let e,n,r,l,a,i;function d(c,o){return c[4]?hn:dn}let f=d(t),s=f(t);return{c(){e=v("div"),n=v("h2"),r=Y(t[26]),l=I(),a=v("div"),s.c(),i=I(),this.h()},l(c){e=b(c,"DIV",{});var o=V(e);n=b(o,"H2",{});var p=V(n);r=Q(p,t[26]),p.forEach(D),l=T(o),a=b(o,"DIV",{class:!0});var A=V(a);s.l(A),A.forEach(D),i=T(o),o.forEach(D),this.h()},h(){_(a,"class","row")},m(c,o){ot(c,e,o),u(e,n),u(n,r),u(e,l),u(e,a),s.m(a,null),u(e,i)},p(c,o){f===(f=d(c))&&s?s.p(c,o):(s.d(1),s=f(c),s&&(s.c(),s.m(a,null)))},d(c){c&&D(e),s.d()}}}function fn(t){let e,n,r,l,a,i,d,f,s,c,o,p,A,x,g,y,w,z,J="Barchart",K,q,m,B,X,ut="Boxplot",st,it,W,h,C,j="Distribution",S,P,zt="",Bt,mt,U,nt,Ht="Map",vt,R,Vt="",bt,H,rt,Ft="Socio Economic Factors",yt,$,_t,tt,Nt="Aggregate Plots",gt,kt,Pt,at=Xt(St),M=[];for(let E=0;E<at.length;E+=1)M[E]=Qt(Yt(t,at,E));return{c(){e=v("div"),n=v("div"),r=v("h1"),l=Y(t[7]),a=I(),i=v("p"),d=Y(t[7]),f=Y(" is ..."),s=I(),c=v("div"),o=v("div"),p=v("h3"),A=Y(t[7]),x=Y(" datazone distribution"),g=I(),y=v("input"),w=I(),z=v("label"),z.textContent=J,K=v("br"),q=I(),m=v("input"),B=I(),X=v("label"),X.textContent=ut,st=v("br"),it=I(),W=v("input"),h=I(),C=v("label"),C.textContent=j,S=I(),P=v("div"),P.innerHTML=zt,mt=I(),U=v("div"),nt=v("h3"),nt.textContent=Ht,vt=I(),R=v("div"),R.innerHTML=Vt,bt=I(),H=v("div"),rt=v("h1"),rt.textContent=Ft,yt=I(),$=v("input"),_t=I(),tt=v("label"),tt.textContent=Nt,gt=I();for(let E=0;E<M.length;E+=1)M[E].c();this.h()},l(E){e=b(E,"DIV",{class:!0});var F=V(e);n=b(F,"DIV",{class:!0});var k=V(n);r=b(k,"H1",{});var ct=V(r);l=Q(ct,t[7]),ct.forEach(D),a=T(k),i=b(k,"P",{});var xt=V(i);d=Q(xt,t[7]),f=Q(xt," is ..."),xt.forEach(D),k.forEach(D),s=T(F),c=b(F,"DIV",{id:!0,class:!0});var dt=V(c);o=b(dt,"DIV",{class:!0});var L=V(o);p=b(L,"H3",{});var Ct=V(p);A=Q(Ct,t[7]),x=Q(Ct," datazone distribution"),Ct.forEach(D),g=T(L),y=b(L,"INPUT",{type:!0,name:!0}),w=T(L),z=b(L,"LABEL",{for:!0,"data-svelte-h":!0}),N(z)!=="svelte-1hwbt9c"&&(z.textContent=J),K=b(L,"BR",{}),q=T(L),m=b(L,"INPUT",{type:!0,name:!0}),B=T(L),X=b(L,"LABEL",{for:!0,"data-svelte-h":!0}),N(X)!=="svelte-1bcp6t5"&&(X.textContent=ut),st=b(L,"BR",{}),it=T(L),W=b(L,"INPUT",{type:!0,name:!0}),h=T(L),C=b(L,"LABEL",{for:!0,"data-svelte-h":!0}),N(C)!=="svelte-27dm33"&&(C.textContent=j),S=T(L),P=b(L,"DIV",{class:!0,"data-svelte-h":!0}),N(P)!=="svelte-111cum5"&&(P.innerHTML=zt),L.forEach(D),mt=T(dt),U=b(dt,"DIV",{class:!0});var ht=V(U);nt=b(ht,"H3",{"data-svelte-h":!0}),N(nt)!=="svelte-vcuthw"&&(nt.textContent=Ht),vt=T(ht),R=b(ht,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),N(R)!=="svelte-1ej9vmv"&&(R.innerHTML=Vt),ht.forEach(D),dt.forEach(D),bt=T(F),H=b(F,"DIV",{id:!0,class:!0});var Z=V(H);rt=b(Z,"H1",{"data-svelte-h":!0}),N(rt)!=="svelte-10q4k3w"&&(rt.textContent=Ft),yt=T(Z),$=b(Z,"INPUT",{type:!0}),_t=T(Z),tt=b(Z,"LABEL",{for:!0,"data-svelte-h":!0}),N(tt)!=="svelte-1kwkdzm"&&(tt.textContent=Nt),gt=T(Z);for(let Dt=0;Dt<M.length;Dt+=1)M[Dt].l(Z);Z.forEach(D),F.forEach(D),this.h()},h(){_(n,"class","component"),_(y,"type","radio"),_(y,"name","visType"),y.value="barchart",y.checked=!0,_(z,"for","html"),_(m,"type","radio"),_(m,"name","visType"),m.value="boxplot",_(X,"for","css"),_(W,"type","radio"),_(W,"name","visType"),W.value="distribution",_(C,"for","javascript"),_(P,"class","plot"),_(o,"class","component column"),he(()=>t[12].call(o)),_(R,"id","map"),_(R,"class","svelte-11y8ase"),_(U,"class","component column"),_(c,"id","vis-block"),_(c,"class","svelte-11y8ase"),_($,"type","checkbox"),_(tt,"for","checkbox"),_(H,"id","multiple-comp"),_(H,"class","component svelte-11y8ase"),_(e,"class","page-container")},m(E,F){ot(E,e,F),u(e,n),u(n,r),u(r,l),u(n,a),u(n,i),u(i,d),u(i,f),u(e,s),u(e,c),u(c,o),u(o,p),u(p,A),u(p,x),u(o,g),u(o,y),u(o,w),u(o,z),u(o,K),u(o,q),u(o,m),u(o,B),u(o,X),u(o,st),u(o,it),u(o,W),u(o,h),u(o,C),u(o,S),u(o,P),t[11](P),Bt=be(o,t[12].bind(o)),u(c,mt),u(c,U),u(U,nt),u(U,vt),u(U,R),t[13](R),u(e,bt),u(e,H),u(H,rt),u(H,yt),u(H,$),$.checked=t[4],u(H,_t),u(H,tt),u(H,gt);for(let k=0;k<M.length;k+=1)M[k]&&M[k].m(H,null);t[18](e),kt||(Pt=[ft(y,"change",t[8]),ft(m,"change",t[8]),ft(W,"change",t[8]),ft($,"change",t[14])],kt=!0)},p(E,[F]){if(F&16&&($.checked=E[4]),F&22){at=Xt(St);let k;for(k=0;k<at.length;k+=1){const ct=Yt(E,at,k);M[k]?M[k].p(ct,F):(M[k]=Qt(ct),M[k].c(),M[k].m(H,null))}for(;k<M.length;k+=1)M[k].d(1);M.length=at.length}},i:qt,o:qt,d(E){E&&D(e),t[11](null),Bt(),t[13](null),ye(M,E),t[18](null),kt=!1,fe(Pt)}}}function pn(t,e,n){let r,l,a={},i={},d="barchart",f=!1,s=300;const c={marginLeft:60,marginRight:60,marginBottom:60,marginTop:60};let{data:o}=e;const p=o.oneLADData,A=o.LAD,x=o.totalCBAllZones,g=o.totalCBAllLAD;let y;console.log(11,x),console.log("ONE LAD",p);let w;pe(()=>{y=new je(A,"LAD",w,"val",!0),y.initMap()});function z(){d=="boxplot"?l?.append(O({height:s/1.4,...c,y:{type:"band"},style:{fontSize:"18px"},marks:[cn(p,{x:"total",y:"scenario",tip:!0}),G(x,et({x:"median"},{x:"total",y:"scenario",stroke:"blue",strokeWidth:2})),G(x,et({x:"mean"},{x:"total",y:"scenario",stroke:"red",strokeWidth:2}))]})):d=="barchart"?l?.append(O({height:s/1.4,...c,y:{type:"band"},style:{fontSize:"18px"},marks:[le(p,et({x:"sum"},{x:"total",y:"scenario"})),G(g,et({x:"mean"},{x:"val",y:"scenario",stroke:"red",strokeWidth:2})),G(g,et({x:"median"},{x:"val",y:"scenario",stroke:"blue",strokeWidth:2}))]})):d=="distribution"&&l?.append(O({height:s/1.4,...c,y:{label:"Datazones Frequency"},style:{fontSize:"18px"},facet:{data:x,y:"scenario"},marks:[Lt(p,It({y:"count"},{x:"total",tip:!0})),Re(x,et({x:"median"},{x:"total",y1:0,y2:1500,fy:"scenario",stroke:"blue",strokeWidth:3}))]}))}function J(){St.forEach(h=>{let C,j;if(f)Ut.includes(h)?C=O({height:s/3,width:500*2,...c,style:{fontSize:"18px"},color:{legend:!0,scheme:"greys"},x:{domain:Oe(0,6),ticks:new Set(p.map(S=>S[h]))},marks:[Gt(p,wt({fill:"count"},{x:h,stroke:"black"})),Gt([Math.floor(Et(x.map(S=>S[h])))],{x:S=>S,stroke:"red",fill:null,strokeWidth:2})]}):C=O({height:s/3,width:500*2,...c,style:{fontSize:"18px"},color:{legend:!0},marks:[G(p,{x:h,tip:!0}),G([Et(p.map(S=>S[h]))],{stroke:"blue",strokeWidth:2}),G([Et(x.map(S=>S[h]))],{stroke:"red",strokeWidth:2})]}),a[h]?.append(C);else{if(Ut.includes(h)){j=O({height:s/2,width:500,...c,y:{grid:!0,label:"mean value (£)"},x:{grid:!0,label:h,type:"band"},style:{fontSize:"18px"},color:{legend:!0},marks:[Zt(x,wt({y:"count"},{x:h}))]});let S=j.scale("x").domain;C=O({height:s/2,width:500,...c,y:{grid:!0,label:"mean value (£)"},x:{grid:!0,label:h,domain:S,tickFormat:P=>Math.floor(P)},style:{fontSize:"18px"},color:{legend:!0},marks:[Zt(p,wt({y:"count"},{x:h}))]})}else{j=O({height:s/2,width:500,...c,style:{fontSize:"18px"},color:{legend:!0},marks:[Lt(x,It({y:"count"},{x:h,tip:!0}))]});let S=j.scale("x").domain;C=O({height:s/2,...c,x:{domain:S},style:{fontSize:"18px"},marks:[Lt(p,It({y:"count"},{x:h,tip:!0}))]})}i[h]?.append(j),a[h]?.append(C)}})}function K(h){n(10,d=h.currentTarget.value)}function q(h){lt[h?"unshift":"push"](()=>{l=h,n(0,l)})}function m(){s=this.clientHeight,n(5,s)}function B(h){lt[h?"unshift":"push"](()=>{w=h,n(6,w)})}function X(){f=this.checked,n(4,f)}function ut(h,C){lt[h?"unshift":"push"](()=>{a[C]=h,n(1,a)})}function st(h,C){lt[h?"unshift":"push"](()=>{a[C]=h,n(1,a)})}function it(h,C){lt[h?"unshift":"push"](()=>{i[C]=h,n(2,i)})}function W(h){lt[h?"unshift":"push"](()=>{r=h,n(3,r)})}return t.$$set=h=>{"data"in h&&n(9,o=h.data)},t.$$.update=()=>{t.$$.dirty&1025&&(l?.firstChild?.remove(),z()),t.$$.dirty&6&&(Object.values(a).forEach(h=>{h?.firstChild?.remove()}),Object.values(i).forEach(h=>{h?.firstChild?.remove()}),J())},[l,a,i,r,f,s,w,A,K,o,d,q,m,B,X,ut,st,it,W]}class Cn extends me{constructor(e){super(),ve(this,e,pn,fn,de,{data:9})}}export{Cn as component};
