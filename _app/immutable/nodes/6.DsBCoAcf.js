import{s as Lt,d as Mt,n as _t,r as Vt,o as It,e as K}from"../chunks/scheduler.tir__IPy.js";import{S as qt,i as Bt,e as d,h as rt,s as z,c,j as V,k as dt,f as x,b as E,g as w,n as p,d as Dt,l as i,o as Ft,p as bt,q as Ht}from"../chunks/index.lN_E3Aly.js";import{m as wt,e as zt}from"../chunks/maplibre-gl.CiiVRyRr.js";import"../chunks/transform.Bxaw71Wc.js";import{e as At,d as Pt,i as Rt,p as Q,g as Et,m as xt,a as Ct}from"../chunks/index.iNGoBIib.js";import{S as pt,a as jt}from"../chunks/globals.GjFR_j0Q.js";import{l as Zt}from"../chunks/_layout.nLQNqYml.js";import{b as Ot,a as ct,c as St,d as Gt,l as Yt}from"../chunks/bar.BcDfX2t9.js";let $=await Zt().then(a=>a.datazones);class Nt{colorScale;map;center;data;component;dataZoneToValue;tooltip;constructor(t,o){this.data=t,this.component=o,this.dataZoneToValue={},t.forEach(n=>{this.dataZoneToValue[n.Lookup_Value]=n.total});for(let n of $.features){let v=n.properties.LSOA21CD;n.properties.value=this.dataZoneToValue[v]}let l=At(t.map(n=>n.total));l.splice(1,0,0),this.colorScale=Pt().domain(l).interpolator(Rt),this.center=[-1.54785,53.79648],this.map=new wt.Map({container:"map",style:{version:8,sources:{},layers:[]},center:this.center,zoom:5,preserveDrawingBuffer:!0}),this.tooltip=document.createElement("div"),this.tooltip.style.position="absolute",this.tooltip.style.backgroundColor="white",this.tooltip.style.padding="5px",this.tooltip.style.border="1px solid black",this.tooltip.style.pointerEvents="none",this.tooltip.style.display="none",this.component.append(this.tooltip)}initMap(){this.map.on("style.load",()=>{this.map.addSource("datazones",{type:"geojson",data:$}),this.map.addLayer({id:"fill",type:"fill",source:"datazones",paint:{"fill-color":["interpolate",["linear"],["get","value"],...this.colorScale.domain().flatMap(t=>[t,this.colorScale(t)])],"fill-opacity":.9}})}),this.map.on("mousemove",t=>{let l=this.map.queryRenderedFeatures(t.point,{layers:["fill"]})[0];if(l){let n=l.properties.value;this.tooltip.innerHTML=`Value: ${n}`,this.tooltip.style.left=t.point.x+10+"px",this.tooltip.style.top=t.point.y+10+"px",this.tooltip.style.display="block"}else this.tooltip.style.display="none"})}update(){for(let t of $.features){let o=t.properties.LSOA21CD;t.properties.value=this.dataZoneToValue[o]}this.map.getSource("datazones").setData($)}}function kt(a,t,o){const l=a.slice();return l[19]=t[o],l[20]=t,l[21]=o,l}function Tt(a){let t,o="",l=a[19];const n=()=>a[12](t,l),v=()=>a[12](null,l);return{c(){t=d("div"),t.innerHTML=o,this.h()},l(h){t=c(h,"DIV",{class:!0,"data-svelte-h":!0}),w(t)!=="svelte-18okkjt"&&(t.innerHTML=o),this.h()},h(){p(t,"class","plot")},m(h,g){Dt(h,t,g),n()},p(h,g){a=h,l!==a[19]&&(v(),l=a[19],n())},d(h){h&&x(t),v()}}}function Ut(a){let t,o,l,n,v,h,g="Congestion is ...",k,f,s,I,A,q,Z,C,O,T,U="Barchart",G,Y,D,e,y,S="Distribution",tt,B,ht="",ut,et,F,P,mt="Map",at,L,ft="",it,M,R,vt="Socio Economic Factors",ot,H,lt,gt,j=zt(pt),u=[];for(let m=0;m<j.length;m+=1)u[m]=Tt(kt(a,j,m));return{c(){t=d("div"),o=d("div"),l=d("h1"),n=rt(a[5]),v=z(),h=d("p"),h.textContent=g,k=z(),f=d("div"),s=d("div"),I=d("h3"),A=rt(a[5]),q=rt(" datazone distribution"),Z=z(),C=d("input"),O=z(),T=d("label"),T.textContent=U,G=d("br"),Y=z(),D=d("input"),e=z(),y=d("label"),y.textContent=S,tt=z(),B=d("div"),B.innerHTML=ht,et=z(),F=d("div"),P=d("h3"),P.textContent=mt,at=z(),L=d("div"),L.innerHTML=ft,it=z(),M=d("div"),R=d("h3"),R.textContent=vt,ot=z(),H=d("div");for(let m=0;m<u.length;m+=1)u[m].c();this.h()},l(m){t=c(m,"DIV",{class:!0});var b=V(t);o=c(b,"DIV",{class:!0});var r=V(o);l=c(r,"H1",{});var N=V(l);n=dt(N,a[5]),N.forEach(x),v=E(r),h=c(r,"P",{"data-svelte-h":!0}),w(h)!=="svelte-1amlh7p"&&(h.textContent=g),r.forEach(x),k=E(b),f=c(b,"DIV",{id:!0,class:!0});var X=V(f);s=c(X,"DIV",{class:!0});var _=V(s);I=c(_,"H3",{});var nt=V(I);A=dt(nt,a[5]),q=dt(nt," datazone distribution"),nt.forEach(x),Z=E(_),C=c(_,"INPUT",{type:!0,name:!0}),O=E(_),T=c(_,"LABEL",{for:!0,"data-svelte-h":!0}),w(T)!=="svelte-1hwbt9c"&&(T.textContent=U),G=c(_,"BR",{}),Y=E(_),D=c(_,"INPUT",{type:!0,name:!0}),e=E(_),y=c(_,"LABEL",{for:!0,"data-svelte-h":!0}),w(y)!=="svelte-27dm33"&&(y.textContent=S),tt=E(_),B=c(_,"DIV",{class:!0,"data-svelte-h":!0}),w(B)!=="svelte-111cum5"&&(B.innerHTML=ht),_.forEach(x),et=E(X),F=c(X,"DIV",{class:!0});var W=V(F);P=c(W,"H3",{"data-svelte-h":!0}),w(P)!=="svelte-vcuthw"&&(P.textContent=mt),at=E(W),L=c(W,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),w(L)!=="svelte-1ej9vmv"&&(L.innerHTML=ft),W.forEach(x),X.forEach(x),it=E(b),M=c(b,"DIV",{id:!0,class:!0});var J=V(M);R=c(J,"H3",{"data-svelte-h":!0}),w(R)!=="svelte-zqlelw"&&(R.textContent=vt),ot=E(J),H=c(J,"DIV",{id:!0,class:!0});var yt=V(H);for(let st=0;st<u.length;st+=1)u[st].l(yt);yt.forEach(x),J.forEach(x),b.forEach(x),this.h()},h(){p(o,"class","component"),p(C,"type","radio"),p(C,"name","visType"),C.value="barchart",C.checked=!0,p(T,"for","html"),p(D,"type","radio"),p(D,"name","visType"),D.value="distribution",p(y,"for","javascript"),p(B,"class","plot"),p(s,"class","component column"),Mt(()=>a[10].call(s)),p(L,"id","map"),p(L,"class","svelte-1qzzqci"),p(F,"class","component column"),p(f,"id","vis-block"),p(f,"class","svelte-1qzzqci"),p(H,"id","multiple-plots"),p(H,"class","svelte-1qzzqci"),p(M,"id","multiple-comp"),p(M,"class","component svelte-1qzzqci"),p(t,"class","page-container")},m(m,b){Dt(m,t,b),i(t,o),i(o,l),i(l,n),i(o,v),i(o,h),i(t,k),i(t,f),i(f,s),i(s,I),i(I,A),i(I,q),i(s,Z),i(s,C),i(s,O),i(s,T),i(s,G),i(s,Y),i(s,D),i(s,e),i(s,y),i(s,tt),i(s,B),a[9](B),ut=Ft(s,a[10].bind(s)),i(f,et),i(f,F),i(F,P),i(F,at),i(F,L),a[11](L),i(t,it),i(t,M),i(M,R),i(M,ot),i(M,H);for(let r=0;r<u.length;r+=1)u[r]&&u[r].m(H,null);a[13](t),lt||(gt=[bt(C,"change",a[6]),bt(D,"change",a[6])],lt=!0)},p(m,[b]){if(b&2){j=zt(pt);let r;for(r=0;r<j.length;r+=1){const N=kt(m,j,r);u[r]?u[r].p(N,b):(u[r]=Tt(N),u[r].c(),u[r].m(H,null))}for(;r<u.length;r+=1)u[r].d(1);u.length=j.length}},i:_t,o:_t,d(m){m&&x(t),a[9](null),ut(),a[11](null),Ht(u,m),a[13](null),lt=!1,Vt(gt)}}}function Xt(a,t,o){let l,n,v={},h="barchart",g,{data:k}=t;const f=k.data,s=k.SEFData,I=k.coBenefit;let A,q;It(()=>{A=new Nt(f,q),A.initMap()});function Z(){h=="barchart"?n?.append(Q({height:g,marginLeft:60,marginRight:60,marginBottom:60,y:{type:"band"},style:{fontSize:"18px"},marks:[Gt(f,Et({x:"mean"},{x:"total",y:"scenario"})),Yt(f,Et({x1:e=>xt(e)-Ct(e),x2:e=>xt(e)+Ct(e)},{x:"total",y:"scenario",stroke:"gray",strokeWidth:3}))]})):h=="distribution"&&n?.append(Q({height:g,marginLeft:60,marginRight:60,y:{label:"Datazones Frequency"},style:{fontSize:"18px"},facet:{data:f,y:"scenario"},marks:[St(f,ct({y:"count"},{x:"total",tip:!0}))]}))}function C(){pt.forEach(e=>{let y;jt.includes(e)?y=Q({height:g/2,width:330,marginLeft:80,marginBottom:60,marginRight:30,marginTop:60,y:{grid:!0,label:"mean value (£)"},x:{grid:!0,label:e,type:"band",tickFormat:S=>Math.floor(S)},style:{fontSize:"18px"},color:{legend:!0},marks:[Ot(s.filter(S=>S.SEFMAME==e),ct({y:"mean"},{x:S=>Math.floor(S.SE).toString(),y:"total"}))]}):y=Q({height:g/2,width:330,marginLeft:80,marginBottom:60,marginRight:30,marginTop:60,y:{grid:!0,label:"mean value (£)"},x:{grid:!0,label:e},style:{fontSize:"18px"},color:{legend:!0},marks:[St(s.filter(S=>S.SEFMAME==e),ct({y:"mean"},{x:"SE",y:"total"}))]}),v[e]?.append(y)})}function O(e){o(8,h=e.currentTarget.value)}function T(e){K[e?"unshift":"push"](()=>{n=e,o(0,n)})}function U(){g=this.clientHeight,o(3,g)}function G(e){K[e?"unshift":"push"](()=>{q=e,o(4,q)})}function Y(e,y){K[e?"unshift":"push"](()=>{v[y]=e,o(1,v)})}function D(e){K[e?"unshift":"push"](()=>{l=e,o(2,l)})}return a.$$set=e=>{"data"in e&&o(7,k=e.data)},a.$$.update=()=>{a.$$.dirty&259&&(n?.firstChild?.remove(),Object.values(v).forEach(e=>{e.firstChild?.remove()}),Z(),C())},[n,v,l,g,q,I,O,k,h,T,U,G,Y,D]}class ie extends qt{constructor(t){super(),Bt(this,t,Xt,Ut,Lt,{data:7})}}export{ie as component};
